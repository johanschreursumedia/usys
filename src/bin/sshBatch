#!/usr/bin/env python

import os
import sys

# Using sshBatch:
# ./sshBatch <HOST> <COMMAND> [--customSshArgs]
# ./sshBatch user@umedia-rn-[0005-0007] "echo 'test'"
# ./sshBatch user@umedia-rn-[0005-0007] "echo 'test'" --customSshArg
#
# The host has to follow the convention "name[<START>-<END>]" where
# [<START>-<END>] specifies a range,  for instance:
# umedia-wk-[0005-0018], umedia-rn-[0001-0002]

hosts = sys.argv[1]
command = sys.argv[2]
customArgs = sys.argv[:3]

hostParts = hosts.split('[')
hostRange = hostParts[1][:-1]
hostPrefix = hostParts[0]

hostStart, hostEnd = hostRange.split("-")
hostPadding = len(hostStart)
hostStart = int(hostStart)
hostEnd = int(hostEnd)

for hostIndex in range(hostStart, hostEnd + 1):
    currentHost = "{0}{1}".format(
        hostPrefix,
        str(hostIndex).zfill(hostPadding)
    )

    print("\nWorking on host {0}:".format(
        currentHost,
        command
    ))

    os.system("ssh {0} {1} {2}".format(
        currentHost,
        command,
        ' '.join(customArgs)
    ))
